# 自定义语义分析程序技术文档

## 目录
1. [系统架构](#系统架构)
2. [核心模块设计](#核心模块设计)
3. [数据结构设计](#数据结构设计)
4. [算法实现](#算法实现)
5. [GUI设计](#GUI设计)
6. [测试框架](#测试框架)
7. [性能分析](#性能分析)
8. [扩展指南](#扩展指南)

## 系统架构

### 整体架构
程序采用分层架构设计，主要包含以下层次：

```
┌─────────────────────────────────────┐
│           GUI表示层                  │
│    (自定义语义分析器GUI)              │
├─────────────────────────────────────┤
│           业务逻辑层                  │
│    (语义分析引擎管理器)               │
├─────────────────────────────────────┤
│           算法实现层                  │
│  S属性分析器 | L属性分析器 | 依赖图分析器 │
├─────────────────────────────────────┤
│           数据访问层                  │
│    (文法解析器、数据结构)             │
└─────────────────────────────────────┘
```

### 模块依赖关系
- GUI层依赖业务逻辑层
- 业务逻辑层依赖算法实现层
- 算法实现层依赖数据访问层
- 各层之间通过接口进行通信

## 核心模块设计

### 1. 语义分析引擎管理器 (语义分析引擎管理器)
**职责**: 统一管理多种语义分析方法
**主要方法**:
- `加载文法(文法内容: str)`: 解析并加载属性文法
- `执行语义分析(分析类型, 输入串, 语法分析结果)`: 执行指定类型的语义分析
- `验证文法特性(分析类型)`: 验证文法是否满足特定属性特性

### 2. 文法解析器 (文法解析器)
**职责**: 解析文法定义文件
**主要方法**:
- `解析文法文件(文法内容: str)`: 解析文法定义
- `_解析产生式(行内容: str)`: 解析单个产生式
- `_解析属性定义(行内容: str)`: 解析属性定义
- `_解析语义规则(行内容: str)`: 解析语义规则

### 3. S属性文法分析器 (S属性文法分析器)
**职责**: 实现S属性文法的语义分析
**主要方法**:
- `验证S属性特性()`: 验证文法是否满足S属性特性
- `执行语义分析(输入串, 语法分析结果)`: 执行S属性语义分析
- `_执行产生式语义动作(产生式)`: 执行单个产生式的语义动作

### 4. L属性文法分析器 (L属性文法分析器)
**职责**: 实现L属性文法的语义分析
**主要方法**:
- `验证L属性特性()`: 验证文法是否满足L属性特性
- `_检查继承属性依赖(规则, 产生式)`: 检查继承属性的依赖关系
- `_处理addtype函数(表达式)`: 处理符号表操作函数

### 5. 依赖图分析器 (依赖图语义分析器)
**职责**: 实现基于依赖图的语义分析
**主要方法**:
- `构建依赖图(语法分析树)`: 构建属性依赖图
- `拓扑排序()`: 对依赖图进行拓扑排序
- `检测循环依赖()`: 检测依赖图中的循环依赖

## 数据结构设计

### 基础数据结构

#### 属性定义 (属性定义)
```python
@dataclass
class 属性定义:
    名称: str                    # 属性名称
    类型: 属性类型               # 综合或继承
    数据类型: 数据类型           # 整数、字符串等
    默认值: Any                  # 默认值
    描述: str                    # 属性描述
```

#### 文法符号 (文法符号)
```python
@dataclass
class 文法符号:
    名称: str                    # 符号名称
    是否终结符: bool             # 是否为终结符
    属性列表: List[属性定义]     # 属性列表
```

#### 产生式 (产生式)
```python
@dataclass
class 产生式:
    编号: int                    # 产生式编号
    左部: str                    # 左部符号
    右部: List[str]              # 右部符号列表
```

#### 语义规则 (语义规则)
```python
@dataclass
class 语义规则:
    目标属性: str                # 目标属性
    表达式: str                  # 计算表达式
    依赖属性: List[str]          # 依赖的属性列表
```

### 复合数据结构

#### 通用属性文法 (通用属性文法)
```python
class 通用属性文法:
    开始符号: str                           # 开始符号
    终结符集合: Set[str]                    # 终结符集合
    非终结符集合: Set[str]                  # 非终结符集合
    产生式列表: List[产生式]                # 产生式列表
    文法符号: Dict[str, 文法符号]           # 符号表
    语义规则表: Dict[int, List[语义规则]]   # 语义规则表
```

#### 依赖图 (依赖图)
```python
class 依赖图:
    节点表: Dict[str, 依赖图节点]           # 节点表
    邻接表: Dict[str, List[str]]           # 邻接表
    反向邻接表: Dict[str, List[str]]       # 反向邻接表
    计算顺序: List[str]                    # 拓扑排序结果
```

## 算法实现

### S属性文法语义分析算法

**算法原理**: S属性文法只包含综合属性，属性值的计算遵循自底向上的顺序。

**实现步骤**:
1. 验证文法的S属性特性
2. 初始化终结符的综合属性
3. 按照语法分析结果的归约顺序执行语义动作
4. 计算每个产生式对应的综合属性值

**时间复杂度**: O(n)，其中n为语法分析步骤数

### L属性文法语义分析算法

**算法原理**: L属性文法包含综合属性和继承属性，继承属性的计算必须满足L属性特性。

**L属性特性验证**:
- 继承属性只能依赖于左部符号的继承属性和左边兄弟符号的属性
- 综合属性可以依赖于任何子符号的属性

**实现步骤**:
1. 验证文法的L属性特性
2. 按照深度优先、从左到右的顺序遍历语法分析树
3. 先计算继承属性，再计算综合属性
4. 处理特殊函数调用（如addtype）

**时间复杂度**: O(n*m)，其中n为节点数，m为平均属性数

### 依赖图语义分析算法

**算法原理**: 构建属性之间的依赖关系图，通过拓扑排序确定计算顺序。

**依赖图构建**:
1. 为每个语义规则创建节点
2. 根据属性依赖关系建立有向边
3. 检测循环依赖

**拓扑排序算法** (Kahn算法):
1. 计算每个节点的入度
2. 将入度为0的节点加入队列
3. 依次处理队列中的节点，更新相邻节点的入度
4. 重复直到队列为空

**循环依赖检测** (DFS + 三色标记):
- 白色(0): 未访问
- 灰色(1): 正在访问
- 黑色(2): 已完成访问

**时间复杂度**: O(V + E)，其中V为节点数，E为边数

## GUI设计

### 界面架构
程序使用Tkinter构建GUI，采用标签页(Notebook)设计：

```python
class 自定义语义分析器GUI:
    def __init__(self):
        self.root = tk.Tk()
        self.notebook = ttk.Notebook(self.root)
        self.创建界面组件()
```

### 事件处理机制
- **文法解析**: 解析用户输入的文法定义
- **语义分析**: 执行选定的语义分析方法
- **文件操作**: 支持文法文件的加载和保存
- **结果展示**: 动态更新分析结果显示

### 界面响应性设计
- 使用ScrolledText组件处理大量文本
- 实现错误信息的友好显示
- 支持实时的分析过程展示

## 测试框架

### 测试架构
程序采用unittest框架进行单元测试：

```python
class Test基础数据结构(unittest.TestCase):
    def test_属性定义创建(self):
        # 测试属性定义的创建
        
class Test文法解析器(unittest.TestCase):
    def test_解析简单文法(self):
        # 测试文法解析功能
```

### 测试覆盖范围
- **单元测试**: 测试各个类和方法的功能
- **集成测试**: 测试模块间的协作
- **功能测试**: 测试完整的分析流程
- **错误测试**: 测试错误处理机制

### 测试用例设计
- **正常用例**: 验证正确输入的处理
- **边界用例**: 测试边界条件
- **异常用例**: 测试错误输入的处理
- **性能用例**: 测试大规模输入的处理

## 性能分析

### 时间复杂度分析
- **文法解析**: O(n)，n为文法定义的行数
- **S属性分析**: O(m)，m为语法分析步骤数
- **L属性分析**: O(m*k)，k为平均属性数
- **依赖图分析**: O(V + E)，V为节点数，E为边数

### 空间复杂度分析
- **文法存储**: O(P + A + R)，P为产生式数，A为属性数，R为规则数
- **依赖图存储**: O(V + E)
- **分析过程存储**: O(S)，S为分析步骤数

### 性能优化策略
1. **缓存机制**: 缓存解析结果避免重复计算
2. **懒加载**: 按需加载和计算数据
3. **内存管理**: 及时释放不需要的数据结构
4. **算法优化**: 使用高效的数据结构和算法

## 扩展指南

### 添加新的语义分析方法
1. 继承基础分析器类
2. 实现特定的分析算法
3. 在引擎管理器中注册新方法
4. 更新GUI界面支持新方法

### 扩展文法格式支持
1. 修改文法解析器
2. 扩展数据结构定义
3. 更新验证逻辑
4. 添加相应的测试用例

### 增强GUI功能
1. 添加新的界面组件
2. 实现新的事件处理
3. 扩展结果展示方式
4. 优化用户体验

### 性能优化建议
1. 使用更高效的数据结构
2. 实现并行计算支持
3. 添加进度显示功能
4. 优化内存使用

---

**开发信息**
- 开发语言: Python 3.7+
- GUI框架: Tkinter
- 测试框架: unittest
- 文档格式: Markdown
- 版本控制: Git

**作者信息**
- 作者: 王海翔
- 学号: 2021060187
- 班级: 计科2203
- 联系方式: [学生邮箱]

---

*最后更新: 2025年6月*
