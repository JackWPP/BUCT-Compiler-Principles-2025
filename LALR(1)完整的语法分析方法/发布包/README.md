# LALR(1)完整的语法分析方法

## 项目概述

本项目实现了LALR(1)完整的语法分析方法，包括上下文无关文法的识别和拓广，LR(1)识别活前缀的状态机，LALR(1)判断；LALR(1)分析表，LR分析过程。

**作者**: 王海翔  
**学号**: 2021060187  
**班级**: 计科2203  

## 功能特性

### 核心功能
- ✅ 上下文无关文法解析和拓广
- ✅ FIRST和FOLLOW集合计算
- ✅ LR(1)项目集族构建
- ✅ LALR(1)状态合并算法
- ✅ LALR(1)分析表生成
- ✅ 基于栈的LALR(1)语法分析
- ✅ 冲突检测和报告
- ✅ 完整的GUI界面
- ✅ 自动机可视化

### 技术特点
- **状态压缩**: 通过合并具有相同核心的LR(1)状态，显著减少状态数量
- **高效分析**: 保持LR(1)的分析能力，同时减少内存占用
- **可视化**: 提供直观的自动机状态转换图
- **用户友好**: 完整的GUI界面，支持文件操作和实时分析

## 算法原理

LALR(1)分析方法是LR(1)分析方法的简化版本：

1. **构建LR(1)项目集族**: 首先构建完整的LR(1)自动机
2. **识别相同核心**: 找出具有相同核心的LR(1)状态
3. **合并状态**: 将相同核心的状态合并，合并其向前看符号集合
4. **构建分析表**: 基于合并后的状态构建LALR(1)分析表
5. **语法分析**: 使用分析表进行基于栈的语法分析

### 核心优势
- **状态数量**: 比LR(1)少，比SLR(1)多
- **分析能力**: 介于SLR(1)和LR(1)之间
- **实用性强**: 被广泛应用于编译器构造

## 安装和运行

### 环境要求
- Python 3.7+
- tkinter (通常随Python安装)
- matplotlib >= 3.5.0
- networkx >= 2.6.0
- numpy >= 1.21.0

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行方式

#### 1. GUI界面模式（推荐）
```bash
python lalr1_main.py
```

#### 2. 命令行测试模式
```bash
python lalr1_main.py --test
```

#### 3. 综合测试
```bash
python comprehensive_test.py
```

## 使用说明

### 1. 文法输入
在"文法输入"标签页中输入上下文无关文法：
- 格式：`左部 -> 右部1 | 右部2 | ...`
- 示例：`E -> E + T | T`
- 支持ε产生式，用`ε`或`epsilon`表示
- 支持注释行，以`#`开头

### 2. 构建分析器
1. 点击"解析文法"按钮解析输入的文法
2. 点击"构建分析器"按钮构建LALR(1)分析器
3. 右侧会显示文法信息、FIRST集合、FOLLOW集合等

### 3. 查看分析表
在"LALR(1)分析表"标签页中：
- 点击"生成分析表"查看完整的分析表
- 点击"检查冲突"检查是否有冲突
- 支持保存分析表到文件

### 4. 语法分析
在"语法分析过程"标签页中：
- 输入要分析的字符串
- 点击"开始分析"进行分析
- 查看详细的分析步骤和结果

### 5. 自动机可视化
在"自动机可视化"标签页中：
- 点击"生成可视化"查看状态转换图
- 选择状态查看详细信息
- 支持保存图片

## 示例文法

### 算术表达式文法
```
E -> E + T | T
T -> T * F | F
F -> ( E ) | id
```

### 简单文法
```
S -> A a | b
A -> b d | ε
```

## 测试结果

基于算术表达式文法的测试结果：
- **LR(1)状态数**: 22个
- **LALR(1)状态数**: 12个
- **状态压缩率**: 45.5%
- **正确输入成功率**: 100%
- **错误输入检测率**: 100%

## 项目结构

```
LALR(1)完整的语法分析方法/
├── lalr1_main.py              # 主程序文件
├── comprehensive_test.py      # 综合测试程序
├── requirements.txt           # 依赖包列表
├── sample_input.txt          # 示例输入文法
├── test_cases.txt            # 测试用例说明
├── README.md                 # 项目说明文档
├── 项目总结.md               # 项目总结报告
├── 项目结构说明.md           # 项目结构说明
└── 作业要求.md               # 作业要求文档
```

## 核心类说明

### Grammar
文法类，负责文法的存储和基本操作：
- `add_production()`: 添加产生式
- `augment_grammar()`: 文法拓广
- `compute_first_sets()`: 计算FIRST集合
- `compute_follow_sets()`: 计算FOLLOW集合

### LR1Automaton
LR(1)自动机类：
- `closure()`: 计算项目集闭包
- `goto()`: 计算GOTO函数
- `build_lr1_automaton()`: 构建LR(1)自动机

### LALR1Automaton
LALR(1)自动机类：
- `build_lalr1_automaton()`: 构建LALR(1)自动机
- `_merge_states_with_same_core()`: 合并相同核心的状态

### LALR1ParsingTable
LALR(1)分析表类：
- `build_parsing_table()`: 构建分析表
- `get_action()`: 获取ACTION表动作
- `get_goto()`: 获取GOTO表状态

### LALR1Parser
LALR(1)语法分析器类：
- `build_parser()`: 构建分析器
- `parse()`: 语法分析

## 技术实现

### 数据结构
- `LR1Item`: LR(1)项目，包含产生式、点位置和向前看符号
- `LALR1Item`: LALR(1)项目，包含产生式、点位置和向前看符号集合
- `Action`: 分析表动作（移进、归约、接受、错误）
- `ParseStep`: 分析步骤记录

### 算法实现
1. **LR(1)闭包计算**: 基于向前看符号的闭包算法
2. **状态合并**: 识别和合并具有相同核心的状态
3. **分析表构建**: 基于合并后的状态构建ACTION和GOTO表
4. **语法分析**: 基于栈的移进-归约分析算法

## 扩展功能

- 支持多种文法格式
- 完整的错误处理和报告
- 可视化状态转换图
- 分析过程的详细记录
- 文件导入导出功能

## 许可证

本项目仅用于学习和教学目的。

## 联系方式

如有问题或建议，请联系：
- 作者：王海翔
- 学号：2021060187
- 班级：计科2203
